---
alwaysApply: true
---

# SpringBoot 프로젝트 구조 규칙

## 패키지 구조

### 도메인별 패키지
- `com.cf.*` (Common Function) - 공통 기능 (comm: 공통 API, login: 로그인, community: 커뮤니티, notification: 알림)
- `com.admin.*` - 시스템 관리 기능 (api: API 관리, batch: 배치 관리, code: 코드 관리, log: 로그 관리, menu: 메뉴 관리, multilang: 다국어 관리, page: 페이지 관리, role: 권한 관리, user: 사용자 관리)
- `com.smw.*` (Summoners War) - 게임 관련 도메인 (admin: 게임 관리자 대시보드, auth: 인증, guild: 길드, monster: 몬스터, rta: RTA)
- `com.sysconf.*` (System Configuration) - 시스템 환경설정 (cache: 캐시, config: 설정, constants: 상수, filter: 필터, interceptor: 인터셉터, security: 보안, servlet: 서블릿, util: 유틸리티, mapper: MyBatis Mapper)

### 레이어 구조
각 도메인 패키지 하위에는 다음 레이어가 존재:

1. **컨트롤러 레이어**
   - `rest/` - REST API 컨트롤러 (**기본 사용**, 프로젝트 내 모든 컨트롤러 사용)

2. **서비스 레이어**
   - `service/` - 비즈니스 로직 인터페이스
   - `service/ServiceImpl.java` - 서비스 구현체

3. **데이터 접근 레이어**
   - `mapper/` - MyBatis Mapper 인터페이스 (**기본 사용**, 모든 데이터 접근은 MyBatis Mapper 사용)
   - `mapper/xml/` - MyBatis Mapper XML (SQL 정의, 예: `user.xml`, `role.xml`)
   - `repository/` - JPA/Hibernate Repository (**사용 금지**, MyBatis Mapper로 대체)

4. **데이터 객체**
   - `dto/request/` - 요청 DTO
   - `dto/response/` - 응답 DTO
   - `entity/` - DB 테이블 매핑 Entity

5. **기타**
   - `batch/` - 배치 작업 관련 (entity, mapper, repository, rest 포함)

## 파일 생성 규칙

### 새 API 생성 시
1. **`rest/` 패키지에 `*Controller.java` 생성** (기본 규칙)
2. `service/` 패키지에 `*Service.java` 인터페이스 및 `*ServiceImpl.java` 구현체 생성
3. `mapper/` 패키지에 `*Mapper.java` 인터페이스 생성
4. `mapper/xml/` 패키지에 `*.xml` 생성 (SQL 정의, 예: `notice.xml`, `role.xml`)
5. 필요시 `dto/request/`, `dto/response/` 패키지에 DTO 생성
6. 필요시 `entity/` 패키지에 Entity 생성

### 네이밍 규칙
- Controller: `*Controller.java` (예: `UserController.java`)
- Service: `*Service.java`, `*ServiceImpl.java`
- Mapper: `*Mapper.java` (인터페이스), `*.xml` (XML 파일, 예: `notice.xml`, `role.xml`)
- DTO: `*Request.java`, `*Response.java`
- Entity: `*.java` (예: `User.java`)

## 애플리케이션 진입점
- `com.Application.java` - 메인 애플리케이션 (scanBasePackages = "com")
- `com.smw.Application.java` - SMW 애플리케이션 (scanBasePackages = "com.smw")

## 사용자 인증 및 세션 처리 규칙

### MyBatis 인터셉터 자동 주입
- `MybatisInterceptor`가 모든 MyBatis 쿼리 실행 시 `SessionThread.SESSION_USER_INFO`에서 사용자 정보를 자동으로 파라미터에 주입합니다.
- **업무 로직(Service, Controller)에서 사용자 정보를 가져올 필요가 없습니다.**
- MyBatis XML 쿼리에서 다음 파라미터를 직접 사용할 수 있습니다:
  - `sess_user_id` - 현재 로그인한 사용자 ID
  - `sess_lang_cd` - 사용자 언어 코드
  - `sess_corg_no` - 사용자 회사 번호
  - `sess_role` - 사용자 권한 정보
  - `siege_view_scope` - 점령전 조회 범위 (기본값: 'C')
  - `sess_guild_id`, `sess_guild_name`, `sess_guild_role` - 길드 정보 (있는 경우)

### 사용자 정보 접근 방법
- **MyBatis XML 쿼리**: `#{sess_user_id}`, `#{sess_lang_cd}` 등으로 직접 사용
- **Controller/Service**: 사용자 정보가 필요한 경우에만 `CookieUtil.getToken(request)` 사용 (인터셉터가 적용되지 않는 경로에서만)
- **인터셉터 적용 경로**: `/api/v1/admin/**`, `/api/v1/siege/**` - 이 경로에서는 자동으로 `SessionThread.SESSION_USER_INFO`에 사용자 정보가 설정됨

### 주의사항
- Controller나 Service에서 `HttpSession`에서 `user_id`를 가져오지 마세요. 쿠키 기반 인증을 사용합니다.
- MyBatis 쿼리에서 사용자 정보가 필요한 경우, 파라미터에 명시적으로 추가하지 말고 `sess_user_id` 등을 직접 사용하세요.
- **JPA Repository 사용 금지**: **모든 데이터 접근은 반드시 MyBatis Mapper를 사용하세요.** JPA Repository를 사용하면 MyBatis 인터셉터가 작동하지 않아 `sess_user_id`가 자동 주입되지 않습니다.
- **변수 생성 금지**: `Map<String, Object> userInfo = SessionThread.SESSION_USER_INFO.get()` 같은 변수를 만들지 마세요. MyBatis 인터셉터가 자동으로 주입하므로 Service에서는 Mapper만 호출하면 됩니다.
- **Entity 사용 금지**: Service 레이어에서 Entity 객체를 직접 조작하지 마세요. 모든 데이터 조작은 MyBatis Mapper를 통해 수행하세요.

## API 네이밍 규칙

### 기본 원칙

#### URL 구조
```
/api/v{version}/{domain}/{resource}/{action}
```
- **version**: API 버전 (v1, v2, ...)
- **domain**: 도메인 영역 (sm, smw, common 등)
- **resource**: 리소스 명 (user, role, cd, mlang 등)
- **action**: 작업 유형 (list, detail, save, popup 등)

#### HTTP Method
- **모든 API는 POST 방식 사용** (RequestBody 일관성 유지)
- 조회 API도 복잡한 검색 조건을 위해 POST 사용

### 작업 유형별 네이밍

#### 1. 조회 (Read)

**목록 조회**
- **URL**: `/api/v1/{domain}/{resource}/list`
- **Method**: POST
- **용도**: 목록 데이터 조회 (검색, 페이징, 필터링 모두 포함)
- **예시**:
  ```
  POST /api/v1/sm/user/list
  POST /api/v1/sm/role/list
  POST /api/v1/sm/cd/list
  ```

**상세 조회**
- **URL**: `/api/v1/{domain}/{resource}/detail`
- **Method**: POST
- **용도**: 단건 상세 데이터 조회
- **예시**:
  ```
  POST /api/v1/sm/user/detail
  POST /api/v1/sm/role/detail
  ```

**특수 목적 조회**
- **URL**: `/api/v1/{domain}/{resource}/{purpose}`
- **Method**: POST
- **용도**: 특정 목적의 조회 (팝업, 그룹 등)
- **예시**:
  ```
  POST /api/v1/sm/user/popup      - 팝업용 간단 목록
  POST /api/v1/sm/cd/group        - 코드 그룹 조회
  POST /api/v1/sm/user/mypage     - 마이페이지 조회
  ```

#### 2. 저장 (Save)

- **URL**: `/api/v1/{domain}/{resource}/save`
- **Method**: POST
- **용도**: 데이터 저장 (생성, 수정, 삭제 모두 통합 처리)
- **Request Body**:
  ```json
  {
    "insertRow": [...],  // 생성할 데이터 (optional)
    "updateRow": [...],  // 수정할 데이터 (optional)
    "deleteRow": [...]   // 삭제할 데이터 (optional)
  }
  ```
  또는 단건인 경우:
  ```json
  {
    "user_id": "USER001",
    "user_nm": "홍길동",
    ...
  }
  ```
- **예시**:
  ```
  POST /api/v1/sm/user/save    - 사용자 저장
  POST /api/v1/sm/cd/save      - 코드 저장
  POST /api/v1/sm/mlang/save   - 다국어 저장
  ```

#### 3. 특수 기능

- **URL**: `/api/v1/{domain}/{resource}/{action}`
- **Method**: POST
- **용도**: 조회/저장 외 특수한 비즈니스 로직
- **예시**:
  ```
  POST /api/v1/sm/user/reset-password  - 비밀번호 재설정
  POST /api/v1/sm/batch/restart        - 배치 재시작
  POST /api/v1/sm/log/export           - 로그 내보내기
  ```

### 네이밍 가이드

#### Resource 명명 규칙
- 단수형 사용: `user`, `role`, `cd`, `mlang`
- 소문자 사용
- 하이픈(`-`) 사용 금지, 언더스코어(`_`) 사용 금지
- 축약어는 최소화하되, 도메인에서 통용되는 용어는 허용

#### Action 명명 규칙
| Action | 용도 | 예시 |
|--------|------|------|
| `list` | 목록 조회 (검색 포함) | `/user/list` |
| `detail` | 상세 조회 | `/user/detail` |
| `save` | 저장 (생성/수정/삭제) | `/user/save` |
| `popup` | 팝업용 조회 | `/user/popup` |
| `group` | 그룹 조회 | `/cd/group` |
| `mypage` | 마이페이지 | `/user/mypage` |
| `reset-password` | 비밀번호 재설정 | `/user/reset-password` |

### Controller 작성 예시

```java
@RestController
@RequestMapping("/api/v1/sm/user")
public class UserController {
    
    /**
     * 사용자 목록 조회 (검색, 필터링, 페이징 포함)
     */
    @PostMapping("/list")
    public ResponseEntity<?> getUserList(@RequestBody Map<String, Object> param) {
        List<Map<String, ?>> list = service.selectUserList(param);
        return ResponseEntity.ok(list);
    }
    
    /**
     * 사용자 상세 조회
     */
    @PostMapping("/detail")
    public ResponseEntity<?> getUserDetail(@RequestBody Map<String, Object> param) {
        Map<String, ?> user = service.selectUserDetail(param);
        return ResponseEntity.ok(user);
    }
    
    /**
     * 팝업용 사용자 목록 (간단한 정보만)
     */
    @PostMapping("/popup")
    public ResponseEntity<?> getUserPopup(@RequestBody Map<String, Object> param) {
        List<Map<String, ?>> list = service.selectUserPopup(param);
        return ResponseEntity.ok(list);
    }
    
    /**
     * 사용자 저장 (생성/수정/삭제 통합)
     */
    @PostMapping("/save")
    @Transactional
    public ResponseEntity<?> saveUser(@RequestBody Map<String, Object> param) {
        service.saveUser(param);
        return ResponseEntity.ok(true);
    }
    
    /**
     * 비밀번호 재설정 (특수 기능)
     */
    @PostMapping("/reset-password")
    @Transactional
    public ResponseEntity<?> resetPassword(@RequestBody Map<String, Object> param) {
        service.resetPassword(param);
        return ResponseEntity.ok(true);
    }
}
```

### ✅ DO (이렇게 하세요)
- ✅ `/api/v1/sm/user/list` - 목록 조회 (검색도 여기서)
- ✅ `/api/v1/sm/user/detail` - 상세 조회
- ✅ `/api/v1/sm/user/save` - 저장 (생성/수정/삭제 모두)
- ✅ `/api/v1/sm/user/popup` - 특수 목적 조회
- ✅ `/api/v1/sm/user/reset-password` - 특수 기능

### ❌ DON'T (이렇게 하지 마세요)
- ❌ `/api/v1/sm/user-list` - 하이픈 사용 금지
- ❌ `/api/v1/sm/user/search` - list로 통합하세요
- ❌ `/api/v1/sm/user/create` - save로 통합하세요
- ❌ `/api/v1/sm/user/update` - save로 통합하세요
- ❌ `/api/v1/sm/user/delete` - save로 통합하세요
- ❌ `/api/v1/common/sm/user/list` - common 불필요

### 주의사항
1. **일관성**: 모든 API는 이 규칙을 따라야 함
2. **문서화**: 주석으로 API 목적 명확히 작성
3. **네이밍**: 명확하고 직관적한 이름 사용
4. **간결함**: 불필요한 depth 제거
