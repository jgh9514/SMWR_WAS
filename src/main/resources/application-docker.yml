# Docker 환경 설정
spring:
  application:
    name: smw
  profiles:
    active: docker
  batch:
    job:
      enabled: true
  datasource:
    driver-class-name: net.sf.log4jdbc.sql.jdbcapi.DriverSpy
    # 쿠버네티스 환경에서는 시크릿에서 값을 가져옵니다 (deployment.yaml 참조)
    # 로컬 개발 환경에서는 환경 변수 또는 기본값을 사용합니다
    url: ${SPRING_DATASOURCE_URL:jdbc:log4jdbc:postgresql://localhost:5432/dummy_db}
    hikari:
      username: ${SPRING_DATASOURCE_USERNAME:dummy_user}
      password: ${SPRING_DATASOURCE_PASSWORD:dummy_password}
      maximum-pool-size: 30 # 배치 작업 병렬 처리 고려하여 증가 (페이지 처리 3개 * 각 페이지마다 여러 DB 작업 + 일반 요청 여유)
      minimum-idle: 10 # 최소 유휴 연결 개수 증가 (배치 작업 대비)
      idle-timeout: 30000
      max-lifetime: 1800000
      connection-timeout: 30000
      leak-detection-threshold: 60000 # 커넥션 누수 감지 (60초)
  servlet:
    multipart.max-file-size: 20MB
    max-request-size: 25MB
  mail:
    enabled: true
    host: smtp.gmail.com
    port: 587
    # 쿠버네티스 환경에서는 시크릿에서 값을 가져옵니다
    # 로컬 개발 환경에서는 환경 변수를 사용하세요
    username: ${MAIL_USERNAME:}
    password: ${MAIL_PASSWORD:}
    from: ${MAIL_FROM:}
    properties:
      mail:
        smtp:
          auth: true
          starttls:
            enable: true
            required: true
          connectiontimeout: 10000
          timeout: 10000
          writetimeout: 10000
          ssl:
            trust: "*"
          enable: true
        debug: false
  jpa:
    properties:
      hibernate:
        show_sql: false
        format_sql: true
        use_sql_comments: true
        type: trace
        dialect: org.hibernate.dialect.PostgreSQL95Dialect
        log:
          use_sql_comments: true

mybatis:
  type-aliases-package: com.summonerswar
  config-location: classpath:mybatis/mybatis-config.xml
  mapper-locations: classpath*:com/**/mapper/xml/*.xml

server:
  port: 8080
  tomcat:
    min-spare-threads: 40
  servlet:
    session:
      timeout: 3600
      cookie:
        http-only: true

logging:
  level:
    org.springframework.boot.autoconfigure: WARN
    org.springframework.boot.autoconfigure.condition: WARN
    org.springframework.boot: WARN
    org.springframework.web: WARN
    org.springframework.orm: WARN
    org.springframework.transaction: WARN
    org.springframework.security: WARN
    org.hibernate: WARN
    org.hibernate.SQL: WARN
    org.hibernate.type.descriptor.sql.BasicBinder: WARN
    jdbc.sqlonly: WARN
    jdbc.sqltiming: WARN
    com.sysconf.interceptor: INFO
    # Tomcat HTTP 파싱 에러 로그 레벨 조정 (HTTPS 요청이 HTTP 포트로 들어올 때 발생하는 에러)
    org.apache.coyote: WARN
    org.apache.catalina: WARN
    org.apache.tomcat: WARN

# Actuator 설정 (Health Check용만)
management:
  endpoints:
    web:
      exposure:
        include: health,info
      base-path: /actuator
  endpoint:
    health:
      show-details: always
  health:
    mail:
      enabled: false  # 메일 헬스 체크 비활성화 (메일 인증 실패로 인한 DOWN 방지)

smw:
  service-domain: localhost, localhost:3000, 13.236.20.39:32282, jgh9514.com, www.jgh9514.com
  globalDblinkNm: SMW_DBLINK
  front-url: http://localhost:3000
  server-url: http://localhost:8080
  cookie-live-time: 600
  cookie-domain: jgh9514.com
  rate-limit:
    max-requests: 1000  # Rate Limit 완화 (1분당 최대 1000회)
    window-seconds: 60

# AWS S3 설정
# IAM 역할을 사용하므로 Access Key와 Secret Key를 설정하지 않습니다.
# AWS SDK가 자동으로 EC2 인스턴스에 부여된 IAM 역할을 감지합니다.
cloud:
  aws:
    s3:
      bucket: summonerswar-community
    region:
      static: ap-northeast-2
    stack:
      auto: false # 중요: K8s 환경에서 불필요한 스택 감지 방지
    # IAM 역할(인스턴스 프로파일)을 사용하도록 강제 설정
    credentials:
      instance-profile: true

