# Docker 환경 설정
spring:
  application:
    name: smw
  profiles:
    active: docker
  batch:
    job:
      enabled: true
  datasource:
    driver-class-name: net.sf.log4jdbc.sql.jdbcapi.DriverSpy
    url: jdbc:log4jdbc:postgresql://postgres:5432/smw_db
    hikari:
      username: ${SPRING_DATASOURCE_USERNAME:smw_user}
      password: ${SPRING_DATASOURCE_PASSWORD:smw_password}
      maximum-pool-size: 30 # 배치 작업 병렬 처리 고려하여 증가 (페이지 처리 3개 * 각 페이지마다 여러 DB 작업 + 일반 요청 여유)
      minimum-idle: 10 # 최소 유휴 연결 개수 증가 (배치 작업 대비)
      idle-timeout: 30000
      max-lifetime: 1800000
      connection-timeout: 30000
      leak-detection-threshold: 60000 # 커넥션 누수 감지 (60초)
  servlet:
    multipart.max-file-size: 20MB
    max-request-size: 25MB
  mail:
    enabled: true
    host: smtp.gmail.com
    port: 587
    username: ${MAIL_USERNAME:jgh9514@gmail.com}
    password: ${MAIL_PASSWORD:dkpgthimeykzielq}
    from: ${MAIL_FROM:jgh9514@gmail.com}
    properties:
      mail:
        smtp:
          auth: true
          starttls:
            enable: true
            required: true
          connectiontimeout: 10000
          timeout: 10000
          writetimeout: 10000
          ssl:
            trust: "*"
          enable: true
        debug: false
  jpa:
    properties:
      hibernate:
        show_sql: false
        format_sql: true
        use_sql_comments: true
        type: trace
        dialect: org.hibernate.dialect.PostgreSQL95Dialect
        log:
          use_sql_comments: true

mybatis:
  type-aliases-package: com.summonerswar
  config-location: classpath:mybatis/mybatis-config.xml
  mapper-locations: classpath*:com/**/mapper/xml/*.xml

server:
  port: 8080
  tomcat:
    min-spare-threads: 40
  servlet:
    session:
      timeout: 3600
      cookie:
        http-only: true

logging:
  level:
    org.springframework.boot.autoconfigure: WARN
    org.springframework.boot.autoconfigure.condition: WARN
    org.springframework.boot: WARN
    org.springframework.web: WARN
    org.springframework.orm: WARN
    org.springframework.transaction: WARN
    org.springframework.security: WARN
    org.hibernate: WARN
    org.hibernate.SQL: WARN
    org.hibernate.type.descriptor.sql.BasicBinder: WARN
    jdbc.sqlonly: WARN
    jdbc.sqltiming: WARN
    com.sysconf.interceptor: INFO
    # Tomcat HTTP 파싱 에러 로그 레벨 조정 (HTTPS 요청이 HTTP 포트로 들어올 때 발생하는 에러)
    org.apache.coyote: WARN
    org.apache.catalina: WARN
    org.apache.tomcat: WARN

# Actuator 설정 (Health Check용만)
management:
  endpoints:
    web:
      exposure:
        include: health,info
      base-path: /actuator
  endpoint:
    health:
      show-details: always
  health:
    mail:
      enabled: false  # 메일 헬스 체크 비활성화 (메일 인증 실패로 인한 DOWN 방지)

smw:
  service-domain: localhost, localhost:3000, 52.64.170.214:32282
  globalDblinkNm: SMW_DBLINK
  front-url: http://localhost:3000
  server-url: http://localhost:8080
  cookie-live-time: 600
  cookie-domain: localhost
  rate-limit:
    max-requests: 1000  # Rate Limit 완화 (1분당 최대 1000회)
    window-seconds: 60

