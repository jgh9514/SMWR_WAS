<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.admin.code.mapper.CdMapper">

	<!-- 코드 그룹 목록 조회 -->
	<select id="selectCdGrpList" parameterType="sqlMap" resultType="sqlMap">
		/* selectCdGrpList */
		SELECT 
			cd_grp_no,
			cd_grp_nm,
			bsns_cd,
			dtl_bsns_cd,
			usg_yn,
			del_yn
		FROM SYS_CD_GRP
		WHERE 1=1
		ORDER BY cd_grp_no ASC
	</select>

	<!-- 코드 목록 조회 -->
	<select id="selectCdList" parameterType="sqlMap" resultType="sqlMap">
		/* selectCdList */
		SELECT 
			cd_grp_no,
			cd,
			sort_sn,
			usg_yn,
			del_yn
		FROM SYS_CD
		WHERE 1=1
		<if test="cd_grp_no != null and cd_grp_no != ''">
			AND cd_grp_no = #{cd_grp_no}
		</if>
		ORDER BY cd_grp_no ASC, sort_sn ASC
	</select>

	<!-- 코드 유틸리티 목록 조회 -->
	<select id="selectCdUtilList" parameterType="sqlMap" resultType="sqlMap">
		/* selectCdUtilList */
		SELECT 
			cd_grp_no,
			cd,
			sort_sn,
			usg_yn,
			del_yn
		FROM SYS_CD
		WHERE 1=1
		<if test="cd_grp_no != null and cd_grp_no != ''">
			AND cd_grp_no = #{cd_grp_no}
		</if>
		ORDER BY cd_grp_no ASC, sort_sn ASC
	</select>

	<!-- 비즈니스 코드 키 조회 -->
	<select id="selectBsnsCdKey" parameterType="sqlMap" resultType="string">
		/* selectBsnsCdKey */
		SELECT MAX(CAST(SUBSTRING(cd_grp_no FROM LENGTH(#{bsns_cd}) + 1) AS INTEGER))
		FROM SYS_CD_GRP
		WHERE bsns_cd = #{bsns_cd}
		  AND cd_grp_no LIKE #{bsns_cd} || '%'
	</select>

	<!-- 비즈니스 코드 개수 조회 -->
	<select id="selectBsnsCount" parameterType="sqlMap" resultType="long">
		/* selectBsnsCount */
		SELECT COUNT(*)
		FROM SYS_CD_GRP
		WHERE bsns_cd = #{bsns_cd}
	</select>

	<!-- 코드 그룹 등록 -->
	<insert id="insertCdGrp" parameterType="sqlMap">
		/* insertCdGrp */
		INSERT INTO SYS_CD_GRP (
			cd_grp_no,
			bsns_cd,
			dtl_bsns_cd,
			crt_user_id,
			crt_date,
			upt_user_id,
			upt_date
		) VALUES (
			#{cd_grp_no},
			#{bsns_cd},
			#{dtl_bsns_cd},
			#{sess_user_id},
			CURRENT_TIMESTAMP,
			#{sess_user_id},
			CURRENT_TIMESTAMP
		)
	</insert>

	<!-- 코드 그룹 수정 -->
	<update id="updateCdGrp" parameterType="sqlMap">
		/* updateCdGrp */
		UPDATE SYS_CD_GRP
		SET dtl_bsns_cd = #{dtl_bsns_cd}
		   ,upt_user_id = #{sess_user_id}
		   ,upt_date = CURRENT_TIMESTAMP
		WHERE cd_grp_no = #{cd_grp_no}
	</update>

	<!-- 코드 그룹 삭제 -->
	<delete id="deleteCdGrp" parameterType="sqlMap">
		/* deleteCdGrp */
		DELETE FROM SYS_CD_GRP
		WHERE cd_grp_no = #{cd_grp_no}
	</delete>

	<!-- 코드 목록 삭제 -->
	<delete id="deleteCdList" parameterType="sqlMap">
		/* deleteCdList */
		DELETE FROM SYS_CD
		WHERE cd_grp_no = #{cd_grp_no}
	</delete>

	<!-- 코드 등록 -->
	<insert id="insertCd" parameterType="sqlMap">
		/* insertCd */
		INSERT INTO SYS_CD (
			cd_grp_no,
			cd,
			sort_sn,
			memo_1,
			memo_2,
			memo_3,
			memo_4,
			memo_5,
			crt_user_id,
			crt_date,
			upt_user_id,
			upt_date
		) VALUES (
			#{cd_grp_no},
			#{cd},
			CAST(#{sort_sn} AS BIGINT),
			#{memo_1},
			#{memo_2},
			#{memo_3},
			#{memo_4},
			#{memo_5},
			#{sess_user_id},
			CURRENT_TIMESTAMP,
			#{sess_user_id},
			CURRENT_TIMESTAMP
		)
	</insert>

	<!-- 코드 수정 -->
	<update id="updateCd" parameterType="sqlMap">
		/* updateCd */
		UPDATE SYS_CD
		SET sort_sn = CAST(#{sort_sn} AS BIGINT)
		   ,memo_1 = #{memo_1}
		   ,memo_2 = #{memo_2}
		   ,memo_3 = #{memo_3}
		   ,memo_4 = #{memo_4}
		   ,memo_5 = #{memo_5}
		   ,upt_user_id = #{sess_user_id}
		   ,upt_date = CURRENT_TIMESTAMP
		WHERE cd_grp_no = #{cd_grp_no}
		  AND cd = #{cd}
	</update>

	<!-- 코드 삭제 -->
	<delete id="deleteCd" parameterType="sqlMap">
		/* deleteCd */
		DELETE FROM SYS_CD
		WHERE cd_grp_no = #{cd_grp_no}
		  AND cd = #{cd}
	</delete>

	<!-- 코드 그룹 번호로 코드 목록 조회 -->
	<select id="selectCdListByCdGrpNo" parameterType="sqlMap" resultType="sqlMap">
		/* selectCdListByCdGrpNo */
		SELECT 
			cd_grp_no,
			cd,
			sort_sn,
			usg_yn,
			del_yn
		FROM SYS_CD
		WHERE cd_grp_no = #{cd_grp_no}
		ORDER BY sort_sn ASC
	</select>

	<!-- 코드 목록 시스템 조회 -->
	<select id="selectCdListSystem" parameterType="sqlMap" resultType="sqlMap">
		/* selectCdListSystem */
		SELECT 
			cd_grp_no,
			cd,
			sort_sn,
			usg_yn,
			del_yn
		FROM SYS_CD
		WHERE 1=1
		<if test="cd_grp_no != null and cd_grp_no != ''">
			AND cd_grp_no = #{cd_grp_no}
		</if>
		ORDER BY cd_grp_no ASC, sort_sn ASC
	</select>

</mapper>

