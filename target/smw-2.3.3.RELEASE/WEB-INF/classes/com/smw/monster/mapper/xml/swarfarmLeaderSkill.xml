<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.smw.monster.mapper.SwarfarmLeaderSkillMapper">

    <!-- 리더 스킬 정보 저장 또는 업데이트 -->
    <insert id="upsertLeaderSkill" parameterType="sqlMap">
        INSERT INTO public.leader_skill_master (
            leader_skill_id,
            attribute,
            amount,
            area,
            element,
            swarfarm_url,
            last_sync_date,
            crt_user_id,
            crt_date,
            upt_user_id,
            upt_date
        ) VALUES (
            #{leader_skill_id},
            #{attribute},
            #{amount},
            #{area},
            #{element},
            #{swarfarm_url},
            CURRENT_TIMESTAMP,
            COALESCE(#{crt_user_id}, 'SYSTEM'),
            CURRENT_TIMESTAMP,
            COALESCE(#{upt_user_id}, 'SYSTEM'),
            CURRENT_TIMESTAMP
        )
        ON CONFLICT (leader_skill_id) 
        DO UPDATE SET
            attribute = EXCLUDED.attribute,
            amount = EXCLUDED.amount,
            area = EXCLUDED.area,
            element = EXCLUDED.element,
            swarfarm_url = EXCLUDED.swarfarm_url,
            last_sync_date = CURRENT_TIMESTAMP,
            upt_user_id = COALESCE(EXCLUDED.upt_user_id, 'SYSTEM'),
            upt_date = CURRENT_TIMESTAMP
    </insert>

    <!-- Leader Skill ID로 리더 스킬 존재 여부 확인 -->
    <select id="countByLeaderSkillId" parameterType="Integer" resultType="Integer">
        SELECT COUNT(*)
        FROM public.leader_skill_master
        WHERE leader_skill_id = #{leader_skill_id}
    </select>

</mapper>

