<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.cf.notification.mapper.NotificationMapper">

	<!-- 알림 목록 조회 -->
	<select id="selectNotificationList" parameterType="sqlMap" resultType="java.util.HashMap">
		SELECT 
			n.notification_id,
			n.user_id,
			n.type,
			n.title,
			n.content,
			n.related_id,
			n.related_url,
			n.is_read,
			n.crt_date,
			n.read_date
		FROM NOTIFICATION n
		WHERE n.user_id = #{user_id}
		  AND n.del_yn = 'N'
		ORDER BY n.is_read ASC, n.crt_date DESC
		LIMIT 50
	</select>

	<!-- 알림 읽음 처리 -->
	<update id="updateNotificationRead" parameterType="sqlMap">
		UPDATE NOTIFICATION
		SET is_read = 'Y',
			read_date = CURRENT_TIMESTAMP,
			upt_date = CURRENT_TIMESTAMP
		WHERE notification_id = #{notification_id}
		  AND user_id = #{user_id}
		  AND del_yn = 'N'
	</update>

	<!-- 모든 알림 읽음 처리 -->
	<update id="updateAllNotificationsRead" parameterType="sqlMap">
		UPDATE NOTIFICATION
		SET is_read = 'Y',
			read_date = CURRENT_TIMESTAMP,
			upt_date = CURRENT_TIMESTAMP
		WHERE user_id = #{user_id}
		  AND is_read = 'N'
		  AND del_yn = 'N'
	</update>

	<!-- 알림 생성 -->
	<insert id="insertNotification" parameterType="sqlMap">
		INSERT INTO NOTIFICATION (
			user_id,
			type,
			title,
			content,
			related_id,
			related_url,
			is_read,
			del_yn,
			crt_user_id,
			crt_date,
			upt_date
		) VALUES (
			#{user_id},
			#{type},
			#{title},
			#{content},
			#{related_id},
			#{related_url},
			'N',
			'N',
			#{crt_user_id},
			CURRENT_TIMESTAMP,
			CURRENT_TIMESTAMP
		)
	</insert>

</mapper>

