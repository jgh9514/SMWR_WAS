<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.smw.monster.mapper.SwarfarmSkillEffectMapper">

    <!-- 스킬 이펙트 정보 저장 또는 업데이트 -->
    <insert id="upsertSkillEffect" parameterType="sqlMap">
        INSERT INTO public.skill_effect_master (
            effect_id,
            name,
            is_buff,
            type,
            description,
            icon_filename,
            icon_path,
            swarfarm_url,
            last_sync_date,
            crt_user_id,
            crt_date,
            upt_user_id,
            upt_date
        ) VALUES (
            #{effect_id},
            #{name},
            COALESCE(#{is_buff}, false),
            #{type},
            #{description},
            #{icon_filename},
            #{icon_path},
            #{swarfarm_url},
            CURRENT_TIMESTAMP,
            COALESCE(#{crt_user_id}, 'SYSTEM'),
            CURRENT_TIMESTAMP,
            COALESCE(#{upt_user_id}, 'SYSTEM'),
            CURRENT_TIMESTAMP
        )
        ON CONFLICT (effect_id) 
        DO UPDATE SET
            name = EXCLUDED.name,
            is_buff = EXCLUDED.is_buff,
            type = EXCLUDED.type,
            description = EXCLUDED.description,
            icon_filename = EXCLUDED.icon_filename,
            icon_path = EXCLUDED.icon_path,
            swarfarm_url = EXCLUDED.swarfarm_url,
            last_sync_date = CURRENT_TIMESTAMP,
            upt_user_id = COALESCE(EXCLUDED.upt_user_id, 'SYSTEM'),
            upt_date = CURRENT_TIMESTAMP
    </insert>

    <!-- Effect ID로 스킬 이펙트 존재 여부 확인 -->
    <select id="countByEffectId" parameterType="Integer" resultType="Integer">
        SELECT COUNT(*)
        FROM public.skill_effect_master
        WHERE effect_id = #{effect_id}
    </select>

</mapper>

