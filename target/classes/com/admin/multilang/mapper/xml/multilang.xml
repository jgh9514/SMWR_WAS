<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.admin.multilang.mapper.MultiLangMapper">

	<!-- 다국어 목록 조회 -->
	<select id="selectMlangList" parameterType="sqlMap" resultType="sqlMap">
		/* selectMlangList */
		SELECT 
			lang_cd,
			mlang_tp_cd,
			mlang_txt,
			mlang_cd as mlang_id
		FROM SYS_MLANG
		WHERE 1=1
		<if test="mlang_tp_cd != null and mlang_tp_cd != ''">
			AND mlang_tp_cd = #{mlang_tp_cd}
		</if>
		<if test="mlang_txt != null and mlang_txt != ''">
			AND mlang_txt LIKE '%' || #{mlang_txt} || '%'
		</if>
		<if test="cd != null and cd != ''">
			AND mlang_cd = #{cd}
		</if>
		ORDER BY mlang_cd ASC
	</select>

	<!-- 다국어 등록 -->
	<insert id="insertMlang" parameterType="sqlMap">
		/* insertMlang */
		INSERT INTO SYS_MLANG (
			mlang_tp_cd,
			lang_cd,
			mlang_cd,
			mlang_txt,
			crt_user_id,
			crt_date,
			upt_user_id,
			upt_date
		) VALUES (
			#{mlang_tp_cd},
			#{lang_cd},
			#{mlang_id},
			#{mlang_txt},
			#{sess_user_id},
			CURRENT_TIMESTAMP,
			#{sess_user_id},
			CURRENT_TIMESTAMP
		)
	</insert>

	<!-- 다국어 수정 -->
	<update id="updateMlang" parameterType="sqlMap">
		/* updateMlang */
		UPDATE SYS_MLANG
		SET mlang_txt = #{mlang_txt}
		   ,upt_user_id = #{sess_user_id}
		   ,upt_date = CURRENT_TIMESTAMP
		WHERE mlang_tp_cd = #{mlang_tp_cd}
		  AND lang_cd = #{sess_lang_cd}
		  AND mlang_cd = #{mlang_id}
	</update>

	<!-- 다국어 삭제 -->
	<delete id="deleteMlang" parameterType="sqlMap">
		/* deleteMlang */
		DELETE FROM SYS_MLANG
		WHERE mlang_tp_cd = #{mlang_tp_cd}
		  AND mlang_cd = #{mlang_id}
	</delete>

	<!-- 다국어 상위 코드로 삭제 -->
	<delete id="deleteMlangUpCd" parameterType="sqlMap">
		/* deleteMlangUpCd */
		DELETE FROM SYS_MLANG
		WHERE mlang_tp_cd = #{mlang_tp_cd}
		  AND mlang_cd LIKE #{up_cd} || '-%'
	</delete>

	<!-- 다국어 I18n 목록 조회 -->
	<select id="selectI18nList" parameterType="sqlMap" resultType="sqlMap">
		/* selectI18nList */
		SELECT 
			mlang_tp_cd,
			mlang_cd as mlang_id,
			MAX(CASE WHEN lang_cd = 'KO' THEN mlang_txt END) as mlang_key,
			MAX(CASE WHEN lang_cd = #{lang_cd} THEN mlang_txt END) as mlang_txt
		FROM SYS_MLANG
		WHERE mlang_tp_cd IN ('LB', 'MS')
		GROUP BY mlang_tp_cd, mlang_cd
	</select>

	<!-- 다국어 목록 조회 (언어 코드별) -->
	<select id="selectMultiLanguageList" parameterType="sqlMap" resultType="sqlMap">
		/* selectMultiLanguageList */
		SELECT 
			mlang_tp_cd,
			lang_cd,
			mlang_cd as mlang_id,
			mlang_txt,
			crt_user_id,
			crt_date,
			upt_user_id,
			upt_date
		FROM SYS_MLANG
		WHERE lang_cd = #{lang_cd}
		ORDER BY mlang_cd ASC
	</select>

	<!-- 다국어 정보 조회 -->
	<select id="selectMlangInfo" parameterType="sqlMap" resultType="string">
		/* selectMlangInfo */
		SELECT mlang_txt
		FROM SYS_MLANG
		WHERE mlang_tp_cd = #{mlang_tp_cd}
		  AND mlang_cd = #{mlang_id}
		  AND lang_cd = #{lang_cd}
	</select>

	<!-- 다국어 목록 정보 조회 -->
	<select id="selectMlangListInfo" parameterType="sqlMap" resultType="sqlMap">
		/* selectMlangListInfo */
		SELECT 
			mlang_tp_cd,
			mlang_cd as mlang_id,
			mlang_txt
		FROM SYS_MLANG
		WHERE 1=1
		<if test="mlang_tp_cd != null and mlang_tp_cd != ''">
			AND mlang_tp_cd = #{mlang_tp_cd}
		</if>
		<if test="lang_cd != null and lang_cd != ''">
			AND lang_cd = #{lang_cd}
		</if>
		ORDER BY mlang_cd ASC
	</select>

	<!-- 다국어 추가/갱신 -->
	<insert id="upsertMlang" parameterType="sqlMap">
		/* upsertMlang */
		INSERT INTO SYS_MLANG (
			mlang_tp_cd,
			lang_cd,
			mlang_cd,
			mlang_txt,
			crt_user_id,
			crt_date,
			upt_user_id,
			upt_date
		) VALUES (
			#{mlang_tp_cd},
			#{lang_cd},
			#{mlang_id},
			#{mlang_txt},
			#{sess_user_id},
			CURRENT_TIMESTAMP,
			#{sess_user_id},
			CURRENT_TIMESTAMP
		)
		ON CONFLICT (mlang_tp_cd, lang_cd, mlang_cd)
		DO UPDATE SET
			mlang_txt = #{mlang_txt},
			upt_user_id = #{sess_user_id},
			upt_date = CURRENT_TIMESTAMP
	</insert>

	<!-- 다국어 다중 삭제 -->
	<delete id="deleteMlangList" parameterType="sqlMap">
		/* deleteMlangList */
		DELETE FROM SYS_MLANG
		WHERE mlang_tp_cd = #{mlang_tp_cd}
		<if test="mlang_id_list != null and mlang_id_list.size() > 0">
			AND mlang_cd IN
			<foreach collection="mlang_id_list" item="item" open="(" separator="," close=")">
				#{item}
			</foreach>
		</if>
	</delete>

	<!-- 역할 다국어 목록 수정 -->
	<update id="updateRoleMlangList" parameterType="sqlMap">
		/* updateRoleMlangList */
		UPDATE SYS_MLANG
		SET mlang_txt = #{mlang_txt}
		   ,upt_user_id = #{sess_user_id}
		   ,upt_date = CURRENT_TIMESTAMP
		WHERE mlang_tp_cd = 'RL'
		  AND mlang_cd = #{role_id}
		  AND lang_cd = #{sess_lang_cd}
	</update>

	<!-- 다국어 시퀀스 조회 -->
	<select id="selectMlangSeq" parameterType="string" resultType="string">
		/* selectMlangSeq */
		SELECT 
			CASE 
				WHEN MAX(mlang_cd) IS NULL THEN #{mlang_tp_cd} || '00000001'
				ELSE #{mlang_tp_cd} || LPAD((CAST(SUBSTRING(MAX(mlang_cd) FROM LENGTH(#{mlang_tp_cd}) + 1) AS INTEGER) + 1)::TEXT, 8, '0')
			END
		FROM SYS_MLANG
		WHERE mlang_tp_cd = #{mlang_tp_cd}
		  AND mlang_cd LIKE #{mlang_tp_cd} || '%'
	</select>

</mapper>

